let restaurant,review,map;window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map),google.maps.event.addListener(t,"tilesloaded",function(){[].slice.apply(document.querySelectorAll("#map a")).forEach(function(e){e.setAttribute("tabindex","-1")})}))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(n,r)=>{self.restaurant=r,r?(DBHelper.fetchReviewsById(t,(e,t)=>{const n=[];for(const e of t)e.restaurant_id==r.id&&n.push(e);fillReviewsHTML(n)}),fillRestaurantHTML(),e(null,r,review)):console.error(n)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const o=document.createElement("td");o.innerHTML=e[n],r.appendChild(o),t.appendChild(r)}}),fillReviewsHTML=((e=self.review)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)}),reviewForm=((e=self.restaurant)=>{const t=document.getElementById("name-input").value,n=document.getElementById("rating-input").value,r=document.getElementById("review-input").value;let a=new FormData;a.append("restaurant_id",parseInt(e.id)),a.append("name",t),a.append("rating",n),a.append("comments",r);let o={};for(const[e,t]of a.entries())o[e]=t;if(a.get("restaurant_id")&&a.get("name")&&a.get("rating")&&a.get("comments"))return addReview(o),a;alert("error")}),addReview=(e=>{let t={name:"addReview",data:JSON.stringify(e),object_type:"review"};navigator.online||"addReview"!=t.name||sendDataOffline(t)}),sendDataOffline=(e=>{console.log("Offline OBJ",e),localStorage.setItem("data",JSON.stringify(e.data)),console.log(`Local storage: ${e.object_type} stored`),window.addEventListener("online",t=>{console.log("Browser online again!");let n=JSON.parse(localStorage.getItem("data"));[...document.querySelectorAll(".reviews_offline")].forEach(e=>{e.classList.remove("reviews_offline"),e.querySelector("offline_label").remove()}),null!==n&&("addReview"===e.name&&(postReview(e.data),console.log("Data sent")),localStorage.removeItem("data"),console.log(`Local storage: ${e.object_type} removed`))})}),postReview=(()=>{fetch("http://localhost:1337/reviews/",{method:"POST",body:reviewForm()}).then(e=>e.json()).catch(e=>console.error("Fetch Error =\n",e)).then(e=>console.log("Success:",e))}),deleteReview=(e=>{fetch("http://localhost:1337/reviews/"+e,{method:"DELETE"}).then(e=>e.json()).catch(e=>console.error("Fetch Error =\n",e)).then(e=>console.log("Success:",e))}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("b");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("span");r.innerHTML=e.createdAt,t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const o=document.createElement("p");o.innerHTML=e.comments,t.appendChild(o);const l=document.createElement("button");return l.setAttribute("onclick","deleteReview("+e.id+")"),l.classList.add("delete-review"),l.innerHTML="X",t.appendChild(l),t}),updateValue=(e=>{document.getElementById("rating-output").value=e}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});